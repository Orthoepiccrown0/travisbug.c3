<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
</head>

<link rel="stylesheet" th:href="@{assets/css/shoppingCart.css}">

<body>

<header th:insert="blocks/header :: header"></header>

<div class="container">

    <!--Section: Block Content-->
    <section th:if="${cart != null}">

        <!--Grid row-->
        <div class="row my-3">

            <!--Grid column-->
            <div class="col-lg-8 col-md-7">

                <!-- Card -->
                <!--/*@thymesVar id="cart" type="java.util.List"*/-->
                <!--/*@thymesVar id="item" type="it.unicam.travisbug.c3.model.OrderDetails"*/-->
                <div class="card wish-list mb-3">
                    <div class="card-body">

                        <h5>
                            Cart:
                            <span th:text="${cart.size()}"></span> item(s)
                        </h5>
                        <div th:each="item : ${cart}">
                            <div class="row mb-4">

                                <div class="col">
                                    <div>
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p id="itemID" style="display: none" th:text="${item.getId()}"></p>
                                                <h5 th:text="${item.getProduct().getName()}" class="card-title"></h5>
                                                <p class="card-subtitle mb-2 text-muted"
                                                   th:text="${item.getProduct().getCategory().getName()}"></p>
                                            </div>
                                            <div>
                                                <div class="input-group number-spinner">
                                                    <label>
                                                        <input id="spinner" type="number"
                                                               th:value="${item.getQuantity()}" min="1"
                                                               th:max="${item.getProduct().getSupply()}" step="1"/>
                                                    </label>
                                                </div>
                                                <small id="passwordHelpBlock" class="form-text text-muted text-center">
                                                    (Note, 1 piece)
                                                </small>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mt-3">
                                            <div>
                                                <a th:href="@{cart/remove/{item_id}(item_id=${item.getId()})}"
                                                   class="card-link-secondary small text-uppercase mr-3"><i
                                                        class="fas fa-trash-alt mr-1"></i> Remove item </a>
                                            </div>
                                            <p class="mb-0">
                                                <span>
                                                    Price for item:
                                                <strong id="price"
                                                        th:text="${'$' + item.getProduct().getPrice()}"></strong>
                                            </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr class="mb-4">
                        </div>
                        <p class="text-primary mb-0"><i class="fas fa-info-circle mr-1"></i> Do not delay the
                            purchase, adding
                            items to your cart does not mean booking them.</p>
                    </div>
                </div>
                <!-- Card -->

                <!-- Card -->
                <div class="card mb-3">
                    <div class="card-body">

                        <h5 class="mb-4">We accept</h5>

                        <img class="mr-2" width="45px"
                             src="https://mdbootstrap.com/wp-content/plugins/woocommerce-gateway-stripe/assets/images/visa.svg"
                             alt="Visa">
                        <img class="mr-2" width="45px"
                             src="https://mdbootstrap.com/wp-content/plugins/woocommerce-gateway-stripe/assets/images/amex.svg"
                             alt="American Express">
                        <img class="mr-2" width="45px"
                             src="https://mdbootstrap.com/wp-content/plugins/woocommerce-gateway-stripe/assets/images/mastercard.svg"
                             alt="Mastercard">
                    </div>
                </div>
                <!-- Card -->

            </div>
            <!--Grid column-->

            <!--Grid column-->
            <div class="col-lg-4 col-md-5">

                <!-- Card -->
                <div class="card mb-3">
                    <div class="card-body">

                        <h5 class="mb-3">The total amount of</h5>

                        <ul class="list-group list-group-flush">
                            <li
                                    class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                                Items amount
                                <span id="items-amount" th:text="'$' + ${amount}"></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                Shipping
                                <span>Free</span>
                            </li>
                            <li
                                    class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                                <div>
                                    <strong>The total amount:</strong>
                                </div>
                                <span><strong id="total" th:text="'$' + ${amount}"></strong></span>
                            </li>
                        </ul>

                        <button type="button" class="btn btn-primary btn-block waves-effect waves-light">go to
                            checkout
                        </button>

                    </div>
                </div>
                <!-- Card -->

            </div>
            <!--Grid column-->

        </div>
        <!--Grid row-->

    </section>
    <!--Section: Block Content-->

    <div th:if="${cart == null}" class="row justify-content-center">
        <div class="col-auto mb-3 text-center">
            <div class="card my-3">
                <div class="card-body">
                    <h2 class="m-5">Your shopping cart is empty.</h2>
                    <a class="btn btn-primary mb-4 mx-auto" href="/">Go shopping</a>
                </div>
            </div>
        </div>
    </div>


    <div th:insert="blocks/footer :: footer"></div>
</div>

<!-- SCRIPTS -->
<!-- JQuery -->
<script src="https://mdbootstrap.com/previews/ecommerce-demo/js/jquery-3.4.1.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://mdbootstrap.com/previews/ecommerce-demo/js/popper.min.js"></script>
<!-- MDB Ecommerce JavaScript -->
<script type="text/javascript" src="https://mdbootstrap.com/previews/ecommerce-demo/js/mdb.ecommerce.min.js"></script>
<script th:src="@{/assets/js/input-spinner.js}"></script>

<script>
    $("input[type='number']").inputSpinner();

    String.prototype.removeCharAt = function (i) {
        var tmp = this.split(''); // convert to an array
        tmp.splice(i - 1, 1); // remove 1 element from the array (adjusting for non-zero-indexed counts)
        return tmp.join(''); // reconstruct the string
    }

    $(document).ready(function () {
        $("#spinner").on("change", function (event) {
            let quantity = $(this).val();
            let id = $("#itemID").html();
            //TODO: ajax
            $.ajax("cart/change/quantity",
                {
                    type: 'POST',
                    data: {quantity: quantity, order_id: id},
                    success: function (data, status, xhr) {
                        $('#items-amount').html(data);
                        $('#total').html(data);
                    }
                }
            );
        });
    });


</script>

</body>
</html>